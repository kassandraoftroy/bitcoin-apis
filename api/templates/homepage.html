<head>
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>

<h1 style='text-align: center;'> Murmur Bitcoin Demo </h1>

<button id='create'>create a murmur wallet</button> <br><br><br>

Sender:&nbsp;&nbsp;&nbsp;<input type="text" name="" id='sender' size='36'><br>
Reciever:&nbsp;<input type="text" name="" id='receiver' size='36'><br>
Amount:&nbsp;&nbsp;&nbsp;<input type="text" name="" id='amount' size='12'><br>
Fee:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="" id='fee' size='12'><br>
<button id='start_button'>start</button>

<p id='log' style='word-wrap: break-word;'> </p>


<script>
	var text = "";
	var n = 0;
	document.getElementById('start_button').onclick = function () {
		var sender = $('#sender').val();
		var fee = $('#fee').val();
		var receiver = $('#receiver').val();
		var amount = $('#amount').val();
		var sig_hashes = [];
		$.ajax({
			url: "{% url 'bitcoin_api' %}",
			data: {'sender': sender, 'amount':amount, 'receiver':receiver, 'fee':fee},
			success: function (data){
				sig_hashes = data.hashes;
				text += "[log] creating transaction: " + data.unsigned + "<br><br>";
				for (i = 0; i < sig_hashes.length; i++) {
					n = i+1;
				    text += "[log] hash #" + n.toString() + ": " +sig_hashes[i] +  "<br>";
				}
				document.getElementById('log').innerHTML = text;
				initECDSA(sig_hashes, data.unsigned)
			}
		});
	}

	function initECDSA (hashes, unsigned) {
		text += "<br>[log] initializing homomorphic signature operation with murmur...";
		document.getElementById('log').innerHTML = text;
		for (i = 0; i < hashes.length; i++) {
			n = i+1
			/* call murmur api here once for each signature */
		}
	}

	document.getElementById('create').onclick = function () {
		$.ajax({
			url: "{% url 'create_testwallet' %}",
			success: function (data){
				text += "[log] new wallet funded! <br>[log] address: " + data.address + "<br>";
				text += "[log] secret key: " + data.priv + "<br>";
				text += "[log] <a target='_blank' href='https://testnet.blockchain.info/address/"+data.address+"'> see here </a><br><br>";
				document.getElementById('log').innerHTML = text;
				$('#sender').val(data.address);
				$('#receiver').val("mfeVwF1taoNGJpT2ozRpuqpYqp37t42SMy")
			}
		});
	}

</script>